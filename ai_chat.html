<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MuscleMap • AI Chat Intake</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="./style.css" />
  <style>
    /* Minimal additions without touching your main style.css */
    .chat-wrap{
      display:flex;
      flex-direction:column;
      height:100%;
      gap:10px;
      padding:12px;
    }
    .chat-log{
      flex:1;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding-right:4px;
    }
    .bubble{
      max-width:min(560px, 95%);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(255,255,255,0.04);
    }
    .bubble.user{ align-self:flex-end; background:rgba(24,169,68,0.10); }
    .bubble.ai{ align-self:flex-start; }
    .bubble .meta{
      opacity:.65;
      font-size:12px;
      margin-bottom:6px;
    }
    .bubble .text{ white-space:pre-wrap; word-break:break-word; }
    .bubble img{
      width:100%;
      max-width:420px;
      border-radius:10px;
      margin-top:8px;
      display:block;
    }
    .composer{
      display:flex;
      gap:10px;
      align-items:flex-end;
    }
    .composer textarea{
      flex:1;
      resize:none;
      min-height:48px;
      max-height:140px;
    }
    .typing{
      display:inline-flex;
      gap:4px;
      align-items:center;
    }
    .dot{
      width:6px;height:6px;border-radius:50%;
      background:rgba(255,255,255,0.55);
      animation: bob 1.2s infinite ease-in-out;
    }
    .dot:nth-child(2){ animation-delay:.15s;}
    .dot:nth-child(3){ animation-delay:.3s;}
    @keyframes bob{
      0%, 80%, 100% { transform: translateY(0); opacity:.5; }
      40% { transform: translateY(-5px); opacity:1; }
    }
    .card{
      margin-top:8px;
      padding:10px;
      border-radius:12px;
      background:rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.08);
    }
    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .small{
      font-size:12px;
      opacity:.75;
    }
    .split{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      height:100%;
    }
    @media (min-width: 980px){
      .split{ grid-template-columns: 1fr 1fr; }
    }
    .viewerBox{
      height: min(520px, 62vh);
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.08);
      background:#0b0b0c;
      position:relative;
    }
    .viewerHud{
      position:absolute;
      top:10px; left:10px;
      background:rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:12px;
      padding:8px 10px;
      font-size:12px;
      max-width: calc(100% - 20px);
    }
    .viewerHud b{ font-size:13px; }
    .muted2{ opacity:.65; font-size:12px; }
    .jsonBox{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      white-space:pre-wrap;
      word-break:break-word;
      margin:0;
    }
  </style>

  <!-- Import map for local Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "./vendor/three/build/three.module.js",
      "three/addons/": "./vendor/three/examples/jsm/"
    }
  }
  </script>
</head>

<body>
  <div class="app">
    <aside class="sidebar" style="width:min(720px, 100%);">
      <div class="panel" style="height: calc(100vh - 24px);">
        <div class="panel-title">AI Intake Chat</div>

        <div class="split">
          <div class="chat-wrap">
            <div class="muted2">Send text and/or a photo. The AI remembers this chat because the full history is sent every message.</div>
            <div id="chatLog" class="chat-log"></div>

            <form id="composer" class="composer">
              <div style="display:flex; flex-direction:column; gap:8px; width:100%;">
                <textarea id="msgInput" class="field" placeholder="Describe the exercise, or ask to add/check one…"></textarea>
                <div style="display:flex; gap:10px; align-items:center;">
                  <input id="imgInput" type="file" accept="image/*" capture="environment" />
                  <button id="sendBtn" class="btn" type="submit">Send</button>
                  <button id="clearBtn" class="btn danger" type="button">Clear</button>
                  <a class="btn secondary" href="./index.html">Back</a>
                </div>
                <div id="statusLine" class="small"></div>
              </div>
            </form>
          </div>

          <div>
            <div class="panel" style="margin:0;">
              <div class="panel-title">3D Preview</div>
              <div class="viewerBox">
                <div id="preview" style="width:100%; height:100%;"></div>
                <div class="viewerHud">
                  <b id="previewTitle">No proposal yet</b><br/>
                  <span id="previewSub" class="muted2">When AI proposes an exercise, muscles will highlight here.</span>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-top:12px;">
              <div class="panel-title">Last AI JSON</div>
              <pre id="jsonOut" class="jsonBox">{}</pre>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <div class="viewer" style="display:flex; align-items:center; justify-content:center;">
      <div class="hud">
        <div class="hud-title">MuscleMap</div>
        <div class="hud-sub">AI Chat Intake</div>
      </div>
    </div>
  </div>

  <script type="module" src="./ai_chat.js"></script>
</body>
</html>
