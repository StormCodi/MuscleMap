<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MuscleMap</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="./style.css" />

  <script type="importmap">
  {
    "imports": {
      "three": "./vendor/three/build/three.module.js",
      "three/addons/": "./vendor/three/examples/jsm/"
    }
  }
  </script>
</head>

<body>
  <div class="app">
    <div class="viewer">
      <div id="view" class="view"></div>

      <div class="hud">
        <div class="hud-top">
          <div class="hud-title">MuscleMap</div>
          <a class="hud-link" href="./ai_chat.html">AI Exercise Builder</a>
          <button id="logoutBtn" class="btn secondary" type="button">Logout</button>
        </div>
        <div class="hud-sub">Tap a muscle • Build a workout • Watch recovery colors</div>

        <div class="hud-row">
          <div class="seg" role="group" aria-label="Heat mode">
            <button id="heatOverallBtn" class="seg-btn on" type="button">Overall heat</button>
            <button id="heatWorkoutBtn" class="seg-btn" type="button" disabled>Workout heat</button>
          </div>
        </div>
      </div>
    </div>

    <aside class="sidebar">
      <!-- Workout / Editor -->
      <div class="panel">
        <div class="panel-head">
          <div class="panel-title" id="workTitle">Workout</div>
          <div class="panel-actions">
            <button id="startWorkoutBtn" class="btn" type="button">Start workout</button>
            <button id="endWorkoutBtn" class="btn danger" type="button" disabled>End</button>
          </div>
        </div>

        <div class="work-meta">
          <div class="pill">
            <span class="pill-k">Time</span>
            <span class="pill-v" id="timerText">—</span>
          </div>
          <div class="pill">
            <span class="pill-k">Status</span>
            <span class="pill-v" id="statusText">No workout</span>
          </div>
        </div>

        <div id="workControls" class="work-controls disabled">
          <label class="field">
            <span>Exercise</span>
            <select id="exerciseSelect"></select>
          </label>
          <button id="addExerciseBtn" class="btn" type="button">Add exercise</button>
        </div>

        <div id="workoutEditor" class="workout-editor">
          <div class="muted">Start a workout to add exercises.</div>
        </div>

        <div id="editorFooter" class="editor-footer hidden">
          <button id="discardEditBtn" class="btn secondary" type="button">Back</button>
          <button id="saveEditBtn" class="btn" type="button">Save changes</button>
        </div>
      </div>

      <!-- Selected -->
      <div class="panel">
        <div class="panel-title">Selected</div>
        <div id="selectedBox" class="selected">
          <div class="selected-name">None</div>
          <div class="selected-meta">Tap a muscle.</div>

          <!-- sensitivity UI -->
          <div id="sensWrap" class="sens-wrap hidden">
            <div class="sens-row">
              <div class="sens-label">Sensitivity</div>
              <div class="sens-val" id="sensValue">1.00×</div>
            </div>

            <input
              id="sensSlider"
              class="sens-slider"
              type="range"
              min="0.05"
              max="1.5"
              step="0.05"
              value="1.00"
            />

            <div class="row">
              <button id="sensSaveBtn" class="btn" type="button">Save</button>
              <button id="sensResetBtn" class="btn secondary" type="button">Reset</button>
            </div>

            <div id="sensStatus" class="sens-status"></div>
          </div>
        </div>
      </div>

      <!-- Legend -->
      <div class="panel">
        <div class="panel-title">Legend</div>
        <div class="legend">
          <div class="legend-row"><span class="swatch s-gray"></span><span>Untrained / baseline</span></div>
          <div class="legend-row"><span class="swatch s-green"></span><span>Freshly trained</span></div>
          <div class="legend-row"><span class="swatch s-yellow"></span><span>Frequent work</span></div>
          <div class="legend-row"><span class="swatch s-orange"></span><span>High load / needs recovery</span></div>
          <div class="legend-row"><span class="swatch s-red"></span><span>Overdoing it</span></div>
        </div>
      </div>

      <!-- Recommendations -->
      <div class="panel">
        <div class="panel-title">Recommendations</div>
        <div id="recsBox" class="recs">
          <div class="muted">Log workouts to get recs.</div>
        </div>
        <div class="row">
          <button id="recsBtn" class="btn secondary" type="button">Generate recs</button>
        </div>
      </div>

      <!-- Workouts -->
      <div class="panel">
        <div class="panel-head">
          <div class="panel-title" id="historyTitle">Workouts</div>
          <div class="panel-actions">
            <button id="prevPageBtn" class="btn secondary" type="button">Prev</button>
            <button id="nextPageBtn" class="btn secondary" type="button">Next</button>
          </div>
        </div>
        <div id="historyBox" class="history"></div>
        <div class="muted tiny" id="pageHint"></div>
      </div>

      <div class="panel footnote">
        Models: Z-Anatomy (CC BY-SA 4.0). Attribute if publishing.
      </div>
    </aside>
  </div>

  <script type="module" src="./main.js"></script>
  <script>
       document.getElementById('logoutBtn').addEventListener('click', async () => {
     if (!confirm('Logout?')) return;
     try {
       await fetch('./api/auth/logout.php', {
         method: 'POST',
         credentials: 'same-origin'
       });
       location.assign('./login.html');
     } catch (e) {
       alert('Logout failed');
     }
   });
  </script>
</body>
</html>
